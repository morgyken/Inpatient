var swfobject=function(){function t(){if(!D){try{var t=j.getElementsByTagName("body")[0].appendChild(f("span"));t.parentNode.removeChild(t)}catch(t){return}D=!0;for(var e=O.length,i=0;i<e;i++)O[i]()}}function e(t){D?t():O[O.length]=t}function i(t){if(typeof U.addEventListener!=M)U.addEventListener("load",t,!1);else if(typeof j.addEventListener!=M)j.addEventListener("load",t,!1);else if(typeof U.attachEvent!=M)y(U,"onload",t);else if("function"==typeof U.onload){var e=U.onload;U.onload=function(){e(),t()}}else U.onload=t}function o(){var t=j.getElementsByTagName("body")[0],e=f(A);e.setAttribute("type",B);var i=t.appendChild(e);if(i){var o=0;!function(){if(typeof i.GetVariable!=M){var s=i.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),P.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(o<10)return o++,void setTimeout(arguments.callee,10);t.removeChild(e),i=null,a()}()}else a()}function a(){var t=R.length;if(t>0)for(var e=0;e<t;e++){var i=R[e].id,o=R[e].callbackFn,a={success:!1,id:i};if(P.pv[0]>0){var h=c(i);if(h)if(!g(R[e].swfVersion)||P.wk&&P.wk<312)if(R[e].expressInstall&&n()){var l={};l.data=R[e].expressInstall,l.width=h.getAttribute("width")||"0",l.height=h.getAttribute("height")||"0",h.getAttribute("class")&&(l.styleclass=h.getAttribute("class")),h.getAttribute("align")&&(l.align=h.getAttribute("align"));for(var _={},u=h.getElementsByTagName("param"),p=u.length,f=0;f<p;f++)"movie"!=u[f].getAttribute("name").toLowerCase()&&(_[u[f].getAttribute("name")]=u[f].getAttribute("value"));r(l,_,i,o)}else d(h),o&&o(a);else m(i,!0),o&&(a.success=!0,a.ref=s(i),o(a))}else if(m(i,!0),o){var y=s(i);y&&typeof y.SetVariable!=M&&(a.success=!0,a.ref=y),o(a)}}}function s(t){var e=null,i=c(t);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=M)e=i;else{var o=i.getElementsByTagName(A)[0];o&&(e=o)}return e}function n(){return!z&&g("6.0.65")&&(P.win||P.mac)&&!(P.wk&&P.wk<312)}function r(t,e,i,o){z=!0,C=o||null,E={success:!1,id:i};var a=c(i);if(a){"OBJECT"==a.nodeName?(b=h(a),x=null):(b=a,x=i),t.id=k,(typeof t.width==M||!/%$/.test(t.width)&&parseInt(t.width,10)<310)&&(t.width="310"),(typeof t.height==M||!/%$/.test(t.height)&&parseInt(t.height,10)<137)&&(t.height="137"),j.title=j.title.slice(0,47)+" - Flash Player Installation";var s=P.ie&&P.win?"ActiveX":"PlugIn",n="MMredirectURL="+U.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+j.title;if(typeof e.flashvars!=M?e.flashvars+="&"+n:e.flashvars=n,P.ie&&P.win&&4!=a.readyState){var r=f("div");i+="SWFObjectNew",r.setAttribute("id",i),a.parentNode.insertBefore(r,a),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}l(t,e,i)}}function d(t){if(P.ie&&P.win&&4!=t.readyState){var e=f("div");t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(h(t),e),t.style.display="none",function(){4==t.readyState?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(h(t),t)}function h(t){var e=f("div");if(P.win&&P.ie)e.innerHTML=t.innerHTML;else{var i=t.getElementsByTagName(A)[0];if(i){var o=i.childNodes;if(o)for(var a=o.length,s=0;s<a;s++)1==o[s].nodeType&&"PARAM"==o[s].nodeName||8==o[s].nodeType||e.appendChild(o[s].cloneNode(!0))}}return e}function l(t,e,i){var o,a=c(i);if(P.wk&&P.wk<312)return o;if(a)if(typeof t.id==M&&(t.id=i),P.ie&&P.win){var s="";for(var n in t)t[n]!=Object.prototype[n]&&("data"==n.toLowerCase()?e.movie=t[n]:"styleclass"==n.toLowerCase()?s+=' class="'+t[n]+'"':"classid"!=n.toLowerCase()&&(s+=" "+n+'="'+t[n]+'"'));var r="";for(var d in e)e[d]!=Object.prototype[d]&&(r+='<param name="'+d+'" value="'+e[d]+'" />');a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+r+"</object>",W[W.length]=t.id,o=c(t.id)}else{var h=f(A);h.setAttribute("type",B);for(var l in t)t[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?h.setAttribute("class",t[l]):"classid"!=l.toLowerCase()&&h.setAttribute(l,t[l]));for(var u in e)e[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&_(h,u,e[u]);a.parentNode.replaceChild(h,a),o=h}return o}function _(t,e,i){var o=f("param");o.setAttribute("name",e),o.setAttribute("value",i),t.appendChild(o)}function u(t){var e=c(t);e&&"OBJECT"==e.nodeName&&(P.ie&&P.win?(e.style.display="none",function(){4==e.readyState?p(t):setTimeout(arguments.callee,10)}()):e.parentNode.removeChild(e))}function p(t){var e=c(t);if(e){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode.removeChild(e)}}function c(t){var e=null;try{e=j.getElementById(t)}catch(t){}return e}function f(t){return j.createElement(t)}function y(t,e,i){t.attachEvent(e,i),H[H.length]=[t,e,i]}function g(t){var e=P.pv,i=t.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,e[0]>i[0]||e[0]==i[0]&&e[1]>i[1]||e[0]==i[0]&&e[1]==i[1]&&e[2]>=i[2]}function v(t,e,i,o){if(!P.ie||!P.mac){var a=j.getElementsByTagName("head")[0];if(a){var s=i&&"string"==typeof i?i:"screen";if(o&&(I=null,T=null),!I||T!=s){var n=f("style");n.setAttribute("type","text/css"),n.setAttribute("media",s),I=a.appendChild(n),P.ie&&P.win&&typeof j.styleSheets!=M&&j.styleSheets.length>0&&(I=j.styleSheets[j.styleSheets.length-1]),T=s}P.ie&&P.win?I&&typeof I.addRule==A&&I.addRule(t,e):I&&typeof j.createTextNode!=M&&I.appendChild(j.createTextNode(t+" {"+e+"}"))}}}function m(t,e){if($){var i=e?"visible":"hidden";D&&c(t)?c(t).style.visibility=i:v("#"+t,"visibility:"+i)}}function w(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=M?encodeURIComponent(t):t}var b,x,C,E,I,T,M="undefined",A="object",S="Shockwave Flash",B="application/x-shockwave-flash",k="SWFObjectExprInst",L="onreadystatechange",U=window,j=document,N=navigator,F=!1,O=[function(){F?o():a()}],R=[],W=[],H=[],D=!1,z=!1,$=!0,P=function(){var t=typeof j.getElementById!=M&&typeof j.getElementsByTagName!=M&&typeof j.createElement!=M,e=N.userAgent.toLowerCase(),i=N.platform.toLowerCase(),o=/win/.test(i?i:e),a=/mac/.test(i?i:e),s=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),n=!1,r=[0,0,0],d=null;if(typeof N.plugins!=M&&typeof N.plugins[S]==A)!(d=N.plugins[S].description)||typeof N.mimeTypes!=M&&N.mimeTypes[B]&&!N.mimeTypes[B].enabledPlugin||(F=!0,n=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),r[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),r[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof U.ActiveXObject!=M)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(d=h.GetVariable("$version"))&&(n=!0,d=d.split(" ")[1].split(","),r=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}catch(t){}return{w3:t,pv:r,wk:s,ie:n,win:o,mac:a}}();P.w3&&((typeof j.readyState!=M&&"complete"==j.readyState||typeof j.readyState==M&&(j.getElementsByTagName("body")[0]||j.body))&&t(),D||(typeof j.addEventListener!=M&&j.addEventListener("DOMContentLoaded",t,!1),P.ie&&P.win&&(j.attachEvent(L,function(){"complete"==j.readyState&&(j.detachEvent(L,arguments.callee),t())}),U==top&&function(){if(!D){try{j.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}t()}}()),P.wk&&function(){D||(/loaded|complete/.test(j.readyState)?t():setTimeout(arguments.callee,0))}(),i(t))),P.ie&&P.win&&window.attachEvent("onunload",function(){for(var t=H.length,e=0;e<t;e++)H[e][0].detachEvent(H[e][1],H[e][2]);for(var i=W.length,o=0;o<i;o++)u(W[o]);for(var a in P)P[a]=null;P=null;for(var s in swfobject)swfobject[s]=null;swfobject=null});return{registerObject:function(t,e,i,o){if(P.w3&&t&&e){var a={};a.id=t,a.swfVersion=e,a.expressInstall=i,a.callbackFn=o,R[R.length]=a,m(t,!1)}else o&&o({success:!1,id:t})},getObjectById:function(t){if(P.w3)return s(t)},embedSWF:function(t,i,o,a,s,d,h,_,u,p){var c={success:!1,id:i};P.w3&&!(P.wk&&P.wk<312)&&t&&i&&o&&a&&s?(m(i,!1),e(function(){o+="",a+="";var e={};if(u&&typeof u===A)for(var f in u)e[f]=u[f];e.data=t,e.width=o,e.height=a;var y={};if(_&&typeof _===A)for(var v in _)y[v]=_[v];if(h&&typeof h===A)for(var w in h)typeof y.flashvars!=M?y.flashvars+="&"+w+"="+h[w]:y.flashvars=w+"="+h[w];if(g(s)){var b=l(e,y,i);e.id==i&&m(i,!0),c.success=!0,c.ref=b}else{if(d&&n())return e.data=d,void r(e,y,i,p);m(i,!0)}p&&p(c)})):p&&p(c)},switchOffAutoHideShow:function(){$=!1},ua:P,getFlashPlayerVersion:function(){return{major:P.pv[0],minor:P.pv[1],release:P.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(t,e,i){return P.w3?l(t,e,i):void 0},showExpressInstall:function(t,e,i,o){P.w3&&n()&&r(t,e,i,o)},removeSWF:function(t){P.w3&&u(t)},createCSS:function(t,e,i,o){P.w3&&v(t,e,i,o)},addDomLoadEvent:e,addLoadEvent:i,getQueryParamValue:function(t){var e=j.location.search||j.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return w(e);for(var i=e.split("&"),o=0;o<i.length;o++)if(i[o].substring(0,i[o].indexOf("="))==t)return w(i[o].substring(i[o].indexOf("=")+1))}return""},expressInstallCallback:function(){if(z){var t=c(k);t&&b&&(t.parentNode.replaceChild(b,t),x&&(m(x,!0),P.ie&&P.win&&(b.style.display="block")),C&&C(E)),z=!1}}}}();!function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),o=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),a=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,s=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,n=(i||a)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,n,r,d,h,l,_,u,p;if(!(e=t.match(s)))throw new Error("invalid data URI");for(n=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),r=!!e[4],d=t.slice(e[0].length),h=r?atob(d):decodeURIComponent(d),l=new ArrayBuffer(h.length),_=new Uint8Array(l),u=0;u<h.length;u+=1)_[u]=h.charCodeAt(u);return i?new Blob([o?_:l],{type:n}):((p=new a).append(l),p.getBlob(n))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,i,o){t(o&&e.toDataURL&&n?n(this.toDataURL(i,o)):this.mozGetAsFile("blob",i))}:e.toDataURL&&n&&(e.toBlob=function(t,e,i){t(n(this.toDataURL(e,i)))})),"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:t.dataURLtoBlob=n}(window),function(){var t,e,i,o,a,s,n,r,d,h,l,_,u={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};if(t=function(){function t(t,e){if("string"==typeof t&&(t=document.getElementById(t.replace("#",""))),!t||!t.offsetWidth)throw"JpegCamera: invalid container";t.innerHTML="",this.view_width=parseInt(t.offsetWidth,10),this.view_height=parseInt(t.offsetHeight,10),this.container=document.createElement("div"),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",t.appendChild(this.container),this.options=this._extend({},this.constructor.DefaultOptions,e),this._engine_init()}return t.DefaultOptions={shutter_ogg_url:"/jpeg_camera/shutter.ogg",shutter_mp3_url:"/jpeg_camera/shutter.mp3",swf_url:"/jpeg_camera/jpeg_camera.swf",on_debug:function(t){return console&&console.log?console.log("JpegCamera: "+t):void 0},quality:.9,shutter:!0,mirror:!1,timeout:0,retry_success:!1,scale:1},t._canvas_supported=!!document.createElement("canvas").getContext,t.canvas_supported=function(){return this._canvas_supported},t.prototype.ready=function(t){return this.options.on_ready=t,this.options.on_ready&&this._is_ready&&this.options.on_ready.call(this,{video_width:this.video_width,video_height:this.video_height}),this},t.prototype._is_ready=!1,t.prototype.error=function(t){return this.options.on_error=t,this.options.on_error&&this._error_occured&&this.options.on_error.call(this,this._error_occured),this},t.prototype._error_occured=!1,t.StatsCaptureScale=.2,t.prototype.get_stats=function(e){var i,a;return i=new o(this,{}),this._engine_capture(i,!1,.1,t.StatsCaptureScale),a=this,i.get_stats(function(t){return e.call(a,t)})},t.prototype.capture=function(t){var e,i,a;return null==t&&(t={}),i=new o(this,t),this._snapshots[i.id]=i,(a=i._options()).shutter&&this._engine_play_shutter_sound(),e=Math.min(1,a.scale),e=Math.max(.01,e),this._engine_capture(i,a.mirror,a.quality,e),i},t.prototype._snapshots={},t.prototype.show_stream=function(){return this._engine_show_stream(),this._displayed_snapshot=null,this},t.prototype.discard_all=function(){var t,e,i;this._displayed_snapshot&&this.show_stream(),i=this._snapshots;for(t in i)e=i[t],this._engine_discard(e),e._discarded=!0;return this._snapshots={},this},t.prototype._extend=function(t){var e,i,o,a,s,n;for(s=0,n=(o=Array.prototype.slice.call(arguments,1)).length;n>s;s++)if(i=o[s])for(e in i)a=i[e],t[e]=a;return t},t.prototype._debug=function(t){return this.options.on_debug?this.options.on_debug.call(this,t):void 0},t.prototype._display=function(t){return this._engine_display(t),this._displayed_snapshot=t},t.prototype._displayed_snapshot=null,t.prototype._discard=function(t){return this._displayed_snapshot===t&&this.show_stream(),this._engine_discard(t),t._discarded=!0,delete this._snapshots[t.id]},t.prototype._prepared=function(t,e){var i;return this.video_width=t,this.video_height=e,this._debug("Camera resolution "+this.video_width+"x"+this.video_height+"px"),i=this,setTimeout(function(){return i._wait_until_stream_looks_ok(!0)},1)},t.prototype._wait_until_stream_looks_ok=function(t){return this.get_stats(function(e){var i;return e.std>2?(this._debug("Stream mean gray value = "+e.mean+" standard deviation = "+e.std),this._debug("Camera is ready"),this._is_ready=!0,this.options.on_ready?this.options.on_ready.call(this,{video_width:this.video_width,video_height:this.video_height}):void 0):(t&&this._debug("Stream mean gray value = "+e.mean+" standard deviation = "+e.std),i=this,setTimeout(function(){return i._wait_until_stream_looks_ok(!1)},100))})},t.prototype._got_error=function(t){return this._debug("Error - "+t),this._error_occured=t,this.options.on_error?this.options.on_error.call(this,this._error_occured):void 0},t.prototype._block_element_access=function(){return this._overlay=document.createElement("div"),this._overlay.style.width="100%",this._overlay.style.height="100%",this._overlay.style.position="absolute",this._overlay.style.top=0,this._overlay.style.left=0,this._overlay.style.zIndex=2,this.container.appendChild(this._overlay)},t.prototype._overlay=null,t.prototype.view_width=null,t.prototype.view_height=null,t._add_prefixed_style=function(t,e,i){var o;return o=e.charAt(0).toUpperCase()+e.slice(1),t.style[e]=i,t.style["Webkit"+o]=i,t.style["Moz"+o]=i,t.style["ms"+o]=i,t.style["O"+o]=i},t}(),navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),window.AudioContext||(window.AudioContext=window.webkitAudioContext),r=function(){var t;if((t=document.createElement("canvas")).getContext&&!t.toBlob)throw"JpegCamera: Canvas-to-Blob is not loaded"},navigator.getUserMedia&&(r(),h="audio/ogg; codecs=vorbis",d="audio/mpeg; ",s=function(t){var e;return!(!(e=document.createElement("video")).canPlayType||!e.canPlayType(t).replace(/no/,""))},i=function(e){function i(){return l=i.__super__.constructor.apply(this,arguments)}return p(i,t),i.prototype._engine_init=function(){var e,i,o,a,n,r;this._debug("Using HTML5 engine"),r=Math.floor(.2*this.view_height),o=Math.floor(.2*this.view_width),this.message=document.createElement("div"),this.message.class="message",this.message.style.width="100%",this.message.style.height="100%",t._add_prefixed_style(this.message,"boxSizing","border-box"),this.message.style.overflow="hidden",this.message.style.textAlign="center",this.message.style.paddingTop=r+"px",this.message.style.paddingBottom=r+"px",this.message.style.paddingLeft=o+"px",this.message.style.paddingRight=o+"px",this.message.style.position="absolute",this.message.style.zIndex=3,this.message.innerHTML="Please allow camera access when prompted by the browser.<br><br>Look for camera icon around your address bar.",this.container.appendChild(this.message),this.video_container=document.createElement("div"),this.video_container.style.width=this.view_width+"px",this.video_container.style.height=this.view_height+"px",this.video_container.style.overflow="hidden",this.video_container.style.position="absolute",this.video_container.style.zIndex=1,this.container.appendChild(this.video_container),this.video=document.createElement("video"),this.video.autoplay=!0,t._add_prefixed_style(this.video,"transform","scalex(-1.0)"),window.AudioContext&&(s(h)?this._load_shutter_sound(this.options.shutter_ogg_url):s(d)&&this._load_shutter_sound(this.options.shutter_mp3_url)),i={video:{optional:[{minWidth:1280},{minWidth:640},{minWidth:480},{minWidth:360}]}},n=this,a=function(t){return n._remove_message(),window.URL?n.video.src=URL.createObjectURL(t):n.video.src=t,n._block_element_access(),n._wait_for_video_ready()},e=function(t){var e;n.message.innerHTML='<span style="color: red;">You have denied camera access.</span><br><br>Look for camera icon around your address bar to change your decision.',t.code;for(e in t)if(t[e],"code"!==e)return void n._got_error(e);return n._got_error("UNKNOWN ERROR")};try{return navigator.getUserMedia(i,a,e)}catch(t){return t,navigator.getUserMedia("video",a,e)}},i.prototype._engine_play_shutter_sound=function(){var t;if(this.shutter_buffer)return t=this.audio_context.createBufferSource(),t.buffer=this.shutter_buffer,t.connect(this.audio_context.destination),t.start(0)},i.prototype._engine_capture=function(t,e,i,o){var a,s;return s=this._get_capture_crop(),a=document.createElement("canvas"),a.width=Math.round(s.width*o),a.height=Math.round(s.height*o),a.getContext("2d").drawImage(this.video,s.x_offset,s.y_offset,s.width,s.height,0,0,Math.round(s.width*o),Math.round(s.height*o)),t._canvas=a,t._mirror=e,t._quality=i},i.prototype._engine_display=function(e){return this.displayed_canvas&&this.container.removeChild(this.displayed_canvas),this.displayed_canvas=e._canvas,this.displayed_canvas.style.width=this.view_width+"px",this.displayed_canvas.style.height=this.view_height+"px",this.displayed_canvas.style.top=0,this.displayed_canvas.style.left=0,this.displayed_canvas.style.position="absolute",this.displayed_canvas.style.zIndex=2,t._add_prefixed_style(this.displayed_canvas,"transform","scalex(-1.0)"),this.container.appendChild(this.displayed_canvas)},i.prototype._engine_get_canvas=function(t){var e;return e=document.createElement("canvas"),e.width=t._canvas.width,e.height=t._canvas.height,e.getContext("2d").drawImage(t._canvas,0,0),e},i.prototype._engine_get_image_data=function(t){var e;return e=t._canvas,e.getContext("2d").getImageData(0,0,e.width,e.height)},i.prototype._engine_get_blob=function(t,e,i,o,a){var s,n;return i?(s=document.createElement("canvas"),s.width=t._canvas.width,s.height=t._canvas.height,(n=s.getContext("2d")).setTransform(1,0,0,1,0,0),n.translate(s.width,0),n.scale(-1,1),n.drawImage(t._canvas,0,0)):s=t._canvas,s.toBlob(function(t){return a(t)},e,o)},i.prototype._engine_discard=function(t){return t._xhr&&t._xhr.abort(),delete t._xhr,delete t._canvas},i.prototype._engine_show_stream=function(){return this.displayed_canvas&&(this.container.removeChild(this.displayed_canvas),this.displayed_canvas=null),this.video_container.style.display="block"},i.prototype._engine_upload=function(t,e,i,o){return this._debug("Uploading the file"),t.get_blob(function(a){var s,n;return s=function(e){return delete t._xhr,t._status=e.target.status,t._response=e.target.responseText,t._status>=200&&t._status<300?t._upload_done():(t._error_message=e.target.statusText||"Unknown error",t._upload_fail())},(n=new XMLHttpRequest).open("POST",e),n.timeout=o,i&&n.setRequestHeader("X-CSRF-Token",i),n.onload=s,n.onerror=s,n.onabort=s,n.send(a),t._xhr=n},"image/jpeg")},i.prototype._remove_message=function(){return this.message.style.display="none"},i.prototype._load_shutter_sound=function(t){var e,i;if(!this.audio_context)return this.audio_context=new AudioContext,(e=new XMLHttpRequest).open("GET",t,!0),e.responseType="arraybuffer",i=this,e.onload=function(){return i.audio_context.decodeAudioData(e.response,function(t){return i.shutter_buffer=t})},e.send()},i.prototype._wait_for_video_ready=function(){var t,e,i,o;return o=parseInt(this.video.videoWidth),i=parseInt(this.video.videoHeight),o>0&&i>0?(this.video_container.appendChild(this.video),this.video_width=o,this.video_height=i,t=this._get_video_crop(),this.video.style.position="relative",this.video.style.width=t.width+"px",this.video.style.height=t.height+"px",this.video.style.left=t.x_offset+"px",this.video.style.top=t.y_offset+"px",this._prepared(this.video_width,this.video_height)):this._status_checks_count>100?this._got_error("Camera failed to initialize in 10 seconds"):(this._status_checks_count++,e=this,setTimeout(function(){return e._wait_for_video_ready()},100))},i.prototype._status_checks_count=0,i.prototype._get_video_crop=function(){var t,e,i,o,a;return i=this.video_width/this.video_height,a=this.view_width/this.view_height,i>=a?(this._debug("Filling height"),o=this.view_height/this.video_height,e=Math.round(this.video_width*o),{width:e,height:this.view_height,x_offset:-Math.floor((e-this.view_width)/2),y_offset:0}):(this._debug("Filling width"),o=this.view_width/this.video_width,t=Math.round(this.video_height*o),{width:this.view_width,height:t,x_offset:0,y_offset:-Math.floor((t-this.view_height)/2)})},i.prototype._get_capture_crop=function(){var t,e,i,o;return i=this.video_width/this.video_height,o=this.view_width/this.view_height,i>=o?(e=Math.round(this.video_height*o),{width:e,height:this.video_height,x_offset:Math.floor((this.video_width-e)/2),y_offset:0}):(t=Math.round(this.video_width/o),{width:this.video_width,height:t,x_offset:0,y_offset:Math.floor((this.video_height-t)/2)})},i}(),window.JpegCamera=i),!window.swfobject)throw"JpegCamera: SWFObject is not loaded";n=function(){return window.swfobject&&swfobject.hasFlashPlayerVersion("9")},(!window.JpegCamera||!window.AudioContext||window.jpeg_camera_force_flash)&&n()&&(e=function(e){function i(){return _=i.__super__.constructor.apply(this,arguments)}return p(i,t),i._send_message=function(t,e){var i,o;return(o=this._instances[parseInt(t)])?(i=Array.prototype.slice.call(arguments,2),this.prototype[e].apply(o,i)):void 0},i._instances={},i._next_id=1,i.prototype._engine_init=function(){var t,e,i,o,a,s,n;return this._debug("Using Flash engine"),this._id=this.constructor._next_id++,this.constructor._instances[this._id]=this,this.view_width<215||this.view_height<138?void this._got_error("camera is too small to display privacy dialog"):(o="flash_object_"+this._id,s={loop:"false",allowScriptAccess:"always",allowFullScreen:"false",quality:"best",wmode:"opaque",menu:"false"},t={id:o,align:"middle"},a={id:this._id,width:this.view_width,height:this.view_height,shutter_url:this.options.shutter_mp3_url},n=this,e=function(t){return t.success?(n._debug("Flash loaded"),n._flash=document.getElementById(o)):n._got_error("Flash loading failed.")},i=document.createElement("div"),i.id="jpeg_camera_flash_"+this._id,i.style.width="100%",i.style.height="100%",this.container.appendChild(i),swfobject.embedSWF(this.options.swf_url,i.id,this.view_width,this.view_height,"9",null,a,s,t,e))},i.prototype._engine_play_shutter_sound=function(){return this._flash._play_shutter()},i.prototype._engine_capture=function(t,e,i,o){return this._flash._capture(t.id,e,i,o)},i.prototype._engine_display=function(t){return this._flash._display(t.id)},i.prototype._engine_get_canvas=function(t){var e;return t._image_data||(t._image_data=this._engine_get_image_data(t)),e=document.createElement("canvas"),e.width=t._image_data.width,e.height=t._image_data.height,e.getContext("2d").putImageData(t._image_data,0,0),e},i.prototype._engine_get_image_data=function(e){var i,o,a,s,n,r,d,h,l,_,u,p,c;for(s=this._flash._get_image_data(e.id),t.canvas_supported()?(o=document.createElement("canvas"),o.width=s.width,o.height=s.height,a=o.getContext("2d"),_=a.createImageData(s.width,s.height)):_={data:[],width:s.width,height:s.height},r=u=0,p=(c=s.data).length;p>u;r=++u)h=c[r],d=4*r,l=h>>16&255,n=h>>8&255,i=255&h,_.data[d+0]=l,_.data[d+1]=n,_.data[d+2]=i,_.data[d+3]=255;return _},i.prototype._engine_get_blob=function(t,e,i,o,a){var s,n;return t._extra_canvas||(t._extra_canvas=this._engine_get_canvas(t)),i?(s=document.createElement("canvas"),s.width=t._canvas.width,s.height=t._canvas.height,(n=s.getContext("2d")).setTransform(1,0,0,1,0,0),n.translate(s.width,0),n.scale(-1,1),n.drawImage(t._extra_canvas,0,0)):s=t._extra_canvas,s.toBlob(function(t){return a(t)},e,o)},i.prototype._engine_discard=function(t){return this._flash._discard(t.id)},i.prototype._engine_show_stream=function(){return this._flash._show_stream()},i.prototype._engine_upload=function(t,e,i,o){return this._flash._upload(t.id,e,i,o)},i.prototype._flash_prepared=function(t,e){return this._block_element_access(),document.body.tabIndex=0,document.body.focus(),this._prepared(t,e)},i.prototype._flash_upload_complete=function(t,e,i,o){var a;return t=parseInt(t),a=this._snapshots[t],a._status=parseInt(e),a._response=o,a._status>=200&&a._status<300?a._upload_done():(a._error_message=i,a._upload_fail())},i}(),window.JpegCamera=e),o=function(){function e(t,e){this.camera=t,this.options=e,this.id=this.constructor._next_snapshot_id++}return e._next_snapshot_id=1,e.prototype._discarded=!1,e.prototype.show=function(){return this._discarded&&raise("discarded snapshot cannot be used"),this.camera._display(this),this},e.prototype.hide=function(){return this.camera.displayed_snapshot()===this&&this.camera.show_stream(),this},e.prototype.get_stats=function(t){return this._discarded&&raise("discarded snapshot cannot be used"),this.get_image_data(function(e){return this._get_stats(e,t)})},e.prototype.get_canvas=function(e){var i;return this._discarded&&raise("discarded snapshot cannot be used"),t._canvas_supported,i=this,setTimeout(function(){return i._extra_canvas||(i._extra_canvas=i.camera._engine_get_canvas(i)),t._add_prefixed_style(i._extra_canvas,"transform","scalex(-1.0)"),e.call(i,i._extra_canvas)},1),!0},e.prototype._extra_canvas=null,e.prototype.get_blob=function(e,i){var o;return null==i&&(i="image/jpeg"),this._discarded&&raise("discarded snapshot cannot be used"),t._canvas_supported,o=this,setTimeout(function(){var t,a;return o._blob_mime!==i&&(o._blob=null),o._blob_mime=i,o._blob?e.call(o,o._blob):(t=o.options.mirror,a=o.options.quality,o.camera._engine_get_blob(o,i,t,a,function(t){return o._blob=t,e.call(o,o._blob)}))},1),!0},e.prototype._blob=null,e.prototype._blob_mime=null,e.prototype.get_image_data=function(t){var e;return this._discarded&&raise("discarded snapshot cannot be used"),e=this,setTimeout(function(){return e._image_data||(e._image_data=e.camera._engine_get_image_data(e)),t.call(e,e._image_data)},1),null},e.prototype._image_data=null,e.prototype.upload=function(t){var e;{if(null==t&&(t={}),this._discarded&&raise("discarded snapshot cannot be used"),!this._uploading){if(this._uploading=!0,this._retry=1,this._upload_options=t,!(e=this._options()).api_url)throw this.camera._debug("Snapshot#upload called without valid api_url"),"Snapshot#upload called without valid api_url";return this._start_upload(e),this}this.camera._debug("Upload already in progress")}},e.prototype._upload_options={},e.prototype._uploading=!1,e.prototype._retry=1,e.prototype.done=function(t){var e;return this._discarded&&raise("discarded snapshot cannot be used"),this._upload_options.on_upload_done=t,(e=this._options()).on_upload_done&&this._done&&e.on_upload_done.call(this,this._response),this},e.prototype._done=!1,e.prototype._response=null,e.prototype.fail=function(t){var e;return this._discarded&&raise("discarded snapshot cannot be used"),this._upload_options.on_upload_fail=t,(e=this._options()).on_upload_fail&&this._fail&&e.on_upload_fail.call(this,this._status,this._error_message,this._response),this},e.prototype._fail=!1,e.prototype._status=null,e.prototype._error_message=null,e.prototype.discard=function(){return this.camera._discard(this),delete this._extra_canvas,delete this._image_data,void delete this._blob},e.prototype._options=function(){return this.camera._extend({},this.camera.options,this.options,this._upload_options)},e.prototype._start_upload=function(t){var e;return e="string"==typeof t.csrf_token&&t.csrf_token.length>0?t.csrf_token:null,this._done=!1,this._response=null,this._fail=!1,this._status=null,this._error_message=null,this.camera._engine_upload(this,t.api_url,e,t.timeout)},e.prototype._get_stats=function(t,e){var i,o,s,n,r,d,h,l,_,u,p;if(!this._stats){for(d=t.width*t.height,h=0,o=new Array(d),s=_=0;d>_;s=_+=1)n=4*s,i=.2126*t.data[n+0]+.7152*t.data[n+1]+.0722*t.data[n+2],i=Math.round(i),h+=i,o[s]=i;for(r=Math.round(h/d),l=0,u=0,p=o.length;p>u;u++)i=o[u],l+=Math.pow(i-r,2);this._stats=new a,this._stats.mean=r,this._stats.std=Math.round(Math.sqrt(l/d))}return e.call(this,this._stats)},e.prototype._stats=null,e.prototype._upload_done=function(){var t,e,i,o;return this.camera._debug("Upload completed with status "+this._status),this._done=!0,t=this._options(),!0===(i=t.retry_success&&t.retry_if&&t.retry_if.call(this,this._status,this._error_message,this._response,this._retry))&&(i=0),"number"==typeof i?(this._retry++,i>0?(e=parseInt(i),this.camera._debug("Will retry the upload in "+e+"ms (attempt #"+this._retry+")"),o=this,setTimeout(function(){return o._start_upload(t)},e)):(this.camera._debug("Will retry the upload immediately (attempt #"+this._retry+")"),this._start_upload(t))):(this._uploading=!1,t.on_upload_done?t.on_upload_done.call(this,this._response):void 0)},e.prototype._upload_fail=function(){var t,e,i,o;return this.camera._debug("Upload failed with status "+this._status),this._fail=!0,t=this._options(),!0===(i=t.retry_if&&t.retry_if.call(this,this._status,this._error_message,this._response,this._retry))&&(i=0),"number"==typeof i?(this._retry++,i>0?(e=parseInt(i),this.camera._debug("Will retry the upload in "+e+"ms (attempt #"+this._retry+")"),o=this,setTimeout(function(){return o._start_upload(t)},e)):(this.camera._debug("Will retry the upload immediately (attempt #"+this._retry+")"),this._start_upload(t))):(this._uploading=!1,t.on_upload_fail?t.on_upload_fail.call(this,this._status,this._error_message,this._response):void 0)},e}(),a=function(){function t(){}return t.prototype.mean=null,t.prototype.std=null,t}()}.call(this);